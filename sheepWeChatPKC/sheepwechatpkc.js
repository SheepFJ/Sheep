/*
项目名称：SiriAI
更新日期：2024-11-20
脚本作者：@Sheepfj
使用声明：⚠️仅供参考，🈲转载与售卖！
脚本说明：pkc+圈x/Loon实现上下文自动回复
使用方法：

================= Quantumult X =================
[rewrite_local]
^https:\/\/movies\.disney\.com\/sheep\/video\/gpt\/([^\/]+)\/([^\/]+)\/? url script-response-body https://raw.githubusercontent.com/SheepFJ/Sheep/main/sheepWeChatPKC/sheepwechatpkc.js

[mitm]
hostname = movies.disney.com
*/

const _0x47ac90=_0x1943;function _0x1943(_0x5786d1,_0x347289){const _0x1ebad3=_0x3ef9();return _0x1943=function(_0x43a515,_0x13870e){_0x43a515=_0x43a515-0x6a;let _0xb454d6=_0x1ebad3[_0x43a515];return _0xb454d6;},_0x1943(_0x5786d1,_0x347289);}(function(_0x56a687,_0x5bee9a){const _0x979d2b=_0x1943,_0xc02db7=_0x56a687();while(!![]){try{const _0x8c4896=-parseInt(_0x979d2b(0xb1))/0x1*(-parseInt(_0x979d2b(0x86))/0x2)+parseInt(_0x979d2b(0x9e))/0x3+-parseInt(_0x979d2b(0x70))/0x4*(parseInt(_0x979d2b(0x83))/0x5)+parseInt(_0x979d2b(0xa9))/0x6*(-parseInt(_0x979d2b(0x78))/0x7)+-parseInt(_0x979d2b(0xa8))/0x8+-parseInt(_0x979d2b(0x73))/0x9*(-parseInt(_0x979d2b(0x7e))/0xa)+parseInt(_0x979d2b(0x8d))/0xb*(parseInt(_0x979d2b(0x92))/0xc);if(_0x8c4896===_0x5bee9a)break;else _0xc02db7['push'](_0xc02db7['shift']());}catch(_0x4d9120){_0xc02db7['push'](_0xc02db7['shift']());}}}(_0x3ef9,0x9b2c0));const _0xcb049f=(function(){let _0x26e0fb=!![];return function(_0x52d383,_0x3fdfa7){const _0x362308=_0x26e0fb?function(){if(_0x3fdfa7){const _0x4061f2=_0x3fdfa7['apply'](_0x52d383,arguments);return _0x3fdfa7=null,_0x4061f2;}}:function(){};return _0x26e0fb=![],_0x362308;};}()),_0x161f7e=_0xcb049f(this,function(){const _0x3ead51=_0x1943;return _0x161f7e['toString']()[_0x3ead51(0xae)](_0x3ead51(0x95))['toString']()['constructor'](_0x161f7e)[_0x3ead51(0xae)]('(((.+)+)+)+$');});_0x161f7e();const _0x13870e=(function(){let _0xd91878=!![];return function(_0xc38494,_0x43e613){const _0x290690=_0xd91878?function(){if(_0x43e613){const _0x2c4679=_0x43e613['apply'](_0xc38494,arguments);return _0x43e613=null,_0x2c4679;}}:function(){};return _0xd91878=![],_0x290690;};}()),_0x43a515=_0x13870e(this,function(){const _0x3a8c45=_0x1943;let _0x2962c6;try{const _0xfa7195=Function(_0x3a8c45(0xb2)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2962c6=_0xfa7195();}catch(_0x50980b){_0x2962c6=window;}const _0x1bff69=_0x2962c6['console']=_0x2962c6[_0x3a8c45(0x99)]||{},_0x224e83=[_0x3a8c45(0x76),'warn',_0x3a8c45(0x8a),_0x3a8c45(0x94),_0x3a8c45(0x7d),'table',_0x3a8c45(0xa0)];for(let _0x50cbe4=0x0;_0x50cbe4<_0x224e83[_0x3a8c45(0xb8)];_0x50cbe4++){const _0x46cdf4=_0x13870e[_0x3a8c45(0xaa)][_0x3a8c45(0xb6)][_0x3a8c45(0x6d)](_0x13870e),_0xb76ff0=_0x224e83[_0x50cbe4],_0x43f7d4=_0x1bff69[_0xb76ff0]||_0x46cdf4;_0x46cdf4['__proto__']=_0x13870e['bind'](_0x13870e),_0x46cdf4[_0x3a8c45(0x6f)]=_0x43f7d4[_0x3a8c45(0x6f)][_0x3a8c45(0x6d)](_0x43f7d4),_0x1bff69[_0xb76ff0]=_0x46cdf4;}});_0x43a515();const url=$request['url'],pattern=/^https:\/\/movies\.disney\.com\/sheep\/video\/gpt\/([^\/]+)\/([^\/]+)\/?/;if(!pattern[_0x47ac90(0x7c)](url))return $done({'status':_0x47ac90(0x6b),'headers':{'Content-Type':_0x47ac90(0x9d)},'body':_0x47ac90(0x8f)});const matches=url[_0x47ac90(0x97)](pattern),username=decodeURIComponent(matches[0x1]),question=decodeURIComponent(matches[0x2])['slice'](0x1),Storage={'get':_0x5c44fd=>$prefs[_0x47ac90(0xac)](_0x5c44fd)||'','set':(_0x28a32a,_0x3c947f)=>$prefs[_0x47ac90(0x88)](_0x3c947f,_0x28a32a)};let storedData=Storage[_0x47ac90(0x79)](_0x47ac90(0x75));storedData=storedData?JSON[_0x47ac90(0x80)](storedData):{};function _0x3ef9(){const _0x435f53=['body','4333189NLPmTs','get','（稍后为你提供设定）','请求成功：','test','exception','7119340rZqWai','application/json','parse','用户数据已重置','stringify','5MRKurw','fetch','set','2cCRFkM','forEach','setValueForKey','A4060097-2A26-4F56-922B-ED9DC946E62B','info','en;q=1.0','✅\x20数据已存储','980617UvWfHj','map','Not\x20Found','@€£','replace','144kKsjmB','✅\x20生成回答:\x20','error','(((.+)+)+)+$','请求失败','match','role','console','concat','⚠️\x20未找到用户设定数据','BackgroundShortcutRunner/1417.1\x20CFNetwork/1406.0.4\x20Darwin/22.4.0','text/plain;\x20charset=utf-8','16281ywysuV','⚠️\x20无效设定格式：','trace','catch','gzip,\x20deflate,\x20br','POST','sheep_wechat_all','content','gpt-4o','✅\x20已为\x20','6963080KQkvif','12ohIYCr','constructor','sheep_wechat_user','valueForKey','HTTP/1.1\x20200\x20OK','search','keep-alive','startsWith','1241140UlxDrU','return\x20(function()\x20','push','*/*','assistant','prototype','join','length','split','HTTP/1.1\x20404\x20Not\x20Found','你现在是一个微信回复助手，你的回答需要在70个字以内，下面是你的一些设定：','bind','user','toString','1136968BeiFAm','open-ai','trim','9noLKCT','then','sheep_wechat_data','log'];_0x3ef9=function(){return _0x435f53;};return _0x3ef9();}if(question==='重启')return delete storedData[username],Storage['set'](_0x47ac90(0x75),JSON[_0x47ac90(0x82)](storedData)),console[_0x47ac90(0x76)]('✅\x20已重置\x20'+username+'\x20的所有数据'),$done({'status':_0x47ac90(0xad),'headers':{'Content-Type':_0x47ac90(0x9d)},'body':_0x47ac90(0x81)});!storedData[username]&&(storedData[username]=[]);const firstEntry=storedData[username][0x0]||{},hasPreset=firstEntry['content']&&firstEntry[_0x47ac90(0xa5)][_0x47ac90(0xb0)]('€£');if(!hasPreset){console[_0x47ac90(0x76)]('⚠️\x20'+username+'\x20还未添加预设，正在执行添加');let userSettingsRaw=Storage['get'](_0x47ac90(0xab));if(!userSettingsRaw)console['log'](_0x47ac90(0x9b));else{let userSettings={};userSettingsRaw[_0x47ac90(0x6a)]('$')[_0x47ac90(0x87)](_0x54f3fb=>{const _0x5e4112=_0x47ac90;let _0x4439da=_0x54f3fb[_0x5e4112(0x6a)]('@');if(_0x4439da[_0x5e4112(0xb8)]===0x3){let _0x4e4eb=_0x4439da[0x0][_0x5e4112(0x72)]();userSettings[_0x4e4eb]={'userSetting':_0x4439da[0x1][_0x5e4112(0x72)](),'assistantSetting':_0x4439da[0x2]['trim']()};}else console[_0x5e4112(0x76)](_0x5e4112(0x9f)+_0x54f3fb);});if(userSettings[username]){const {userSetting,assistantSetting}=userSettings[username],settingData=[{'content':'€£'+userSetting,'role':_0x47ac90(0x6e)},{'content':assistantSetting,'role':_0x47ac90(0xb5)}];storedData[username]=settingData[_0x47ac90(0x9a)](storedData[username]);let updatedSettingsRaw=userSettingsRaw[_0x47ac90(0x91)](username+'@'+userSetting+'@'+assistantSetting,username+_0x47ac90(0x90)+userSetting+'@'+assistantSetting);Storage[_0x47ac90(0x85)]('sheep_wechat_user',updatedSettingsRaw),console['log'](_0x47ac90(0xa7)+username+'\x20添加预设');}}}storedData[username][_0x47ac90(0xb3)]({'content':question,'role':'user'}),storedData[username][_0x47ac90(0xb3)]({'content':'待回答','role':_0x47ac90(0xb5)}),Storage['set'](_0x47ac90(0x75),JSON[_0x47ac90(0x82)](storedData));let globalSettings=Storage[_0x47ac90(0x79)](_0x47ac90(0xa4))||_0x47ac90(0x7a),messages=[{'content':_0x47ac90(0x6c)+globalSettings,'role':'user'},{'content':'好的，我会遵循设定，还有什么补充呢','role':'assistant'}];storedData[username][_0x47ac90(0x87)](_0x4bb157=>{const _0x4b1573=_0x47ac90;!(_0x4bb157[_0x4b1573(0x98)]===_0x4b1573(0xb5)&&_0x4bb157[_0x4b1573(0xa5)]==='待回答')&&messages[_0x4b1573(0xb3)](_0x4bb157);});const requestBody=JSON['stringify']({'fuid':'rWuHN9EPIHQwRVVGEUHd4qBX5Sj1','messages':messages,'aiModelProvider':_0x47ac90(0x71),'language':'EN','subscriptionType':'premium','aiModelVersion':_0x47ac90(0xa6),'user':_0x47ac90(0x89)}),myRequest={'url':'https://chatme-backend-d5f358e587a4.herokuapp.com/chatme/api/v1/ask/text','method':_0x47ac90(0xa3),'headers':{'Accept':_0x47ac90(0xb4),'Accept-Encoding':_0x47ac90(0xa2),'Connection':_0x47ac90(0xaf),'Content-Type':_0x47ac90(0x7f),'Host':'chatme-backend-d5f358e587a4.herokuapp.com','User-Agent':_0x47ac90(0x9c),'Accept-Language':_0x47ac90(0x8b)},'body':requestBody};$task[_0x47ac90(0x84)](myRequest)[_0x47ac90(0x74)](_0x2df9b5=>{const _0x21bb9e=_0x47ac90;console[_0x21bb9e(0x76)](_0x21bb9e(0x7b)+_0x2df9b5['body']);const _0x4a2f61=_0x2df9b5[_0x21bb9e(0x77)][_0x21bb9e(0x97)](/"content":"(.*?)"/g);if(!_0x4a2f61)return $done({'body':'请求成功，但未找到回答'});const _0x3740e0=_0x4a2f61[_0x21bb9e(0x8e)](_0x20f0d5=>_0x20f0d5[_0x21bb9e(0x91)](/"content":"|"/g,'')),_0x3b49ae=_0x3740e0[_0x21bb9e(0xb7)]('');console[_0x21bb9e(0x76)](_0x21bb9e(0x93)+_0x3b49ae),storedData[username]=storedData[username]['map'](_0x1dccdb=>{const _0x3d7000=_0x21bb9e;if(_0x1dccdb[_0x3d7000(0x98)]===_0x3d7000(0xb5)&&_0x1dccdb[_0x3d7000(0xa5)]==='待回答')return{'content':_0x3b49ae,'role':_0x3d7000(0xb5)};return _0x1dccdb;}),Storage['set']('sheep_wechat_data',JSON[_0x21bb9e(0x82)](storedData)),console['log'](_0x21bb9e(0x8c)),$done({'status':_0x21bb9e(0xad),'headers':{'Content-Type':_0x21bb9e(0x9d)},'body':_0x3b49ae});})[_0x47ac90(0xa1)](_0x18e10e=>{const _0x12f6a4=_0x47ac90;console[_0x12f6a4(0x76)]('❌\x20请求失败：'+JSON['stringify'](_0x18e10e)),$done({'body':_0x12f6a4(0x96)});});