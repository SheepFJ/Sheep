/*
项目名称：SiriAI
更新日期：2024-11-20
脚本作者：@Sheepfj
使用声明：⚠️仅供参考，🈲转载与售卖！
脚本说明：pkc+圈x/Loon实现上下文自动回复
使用方法：

================= Quantumult X =================
[rewrite_local]
^https:\/\/movies\.disney\.com\/sheep\/video\/gpt\/([^\/]+)\/([^\/]+)\/? url script-response-body https://raw.githubusercontent.com/SheepFJ/Sheep/main/sheepWeChatPKC/sheepwechatpkc.js

[mitm]
hostname = movies.disney.com
*/

const _0x4c2657=_0x4e02;(function(_0x321d44,_0x4df037){const _0xd9a2b4=_0x4e02,_0x20bdae=_0x321d44();while(!![]){try{const _0x5313a7=-parseInt(_0xd9a2b4(0x1ff))/0x1+parseInt(_0xd9a2b4(0x1c0))/0x2+parseInt(_0xd9a2b4(0x1e9))/0x3*(parseInt(_0xd9a2b4(0x1b8))/0x4)+-parseInt(_0xd9a2b4(0x1d0))/0x5+parseInt(_0xd9a2b4(0x1d2))/0x6*(parseInt(_0xd9a2b4(0x1c9))/0x7)+-parseInt(_0xd9a2b4(0x1cb))/0x8*(parseInt(_0xd9a2b4(0x1dd))/0x9)+parseInt(_0xd9a2b4(0x1fc))/0xa;if(_0x5313a7===_0x4df037)break;else _0x20bdae['push'](_0x20bdae['shift']());}catch(_0x50dc42){_0x20bdae['push'](_0x20bdae['shift']());}}}(_0x2ce9,0x66c4a));function _0x2ce9(){const _0x178e7d=['warn','constructor','@€£','then','3406543rOGPoN','forEach','104GuurHA','rWuHN9EPIHQwRVVGEUHd4qBX5Sj1','assistant','search','startsWith','2488470MhskxQ','parse','6jGcJEx','fetch','*/*','bind','HTTP/1.1\x20200\x20OK','trim','get','POST','content','slice','return\x20(function()\x20','470889rkYxac','text/plain;\x20charset=utf-8','user','replace','premium','url','A4060097-2A26-4F56-922B-ED9DC946E62B','join','prototype','请求成功：','table','en;q=1.0','9mnKqcM','trace','https://chatme-backend-d5f358e587a4.herokuapp.com/chatme/api/v1/ask/text','role','map','catch','__proto__','split','Not\x20Found','log','stringify','error','(((.+)+)+)+$','\x20的所有数据','body','exception','keep-alive','✅\x20数据已存储','gzip,\x20deflate,\x20br','8189520FbheGZ','length','❌\x20请求失败：','819652dwzZDU','✅\x20已为\x20','apply','toString','match','你现在是一个微信回复助手，你的回答需要在70个字以内，下面是你的一些设定：','sheep_wechat_user','HTTP/1.1\x20404\x20Not\x20Found','726436vVlrZZ','{}.constructor(\x22return\x20this\x22)(\x20)','push','（稍后为你提供设定）','sheep_wechat_data','待回答','set','sheep_wechat_all','1136058AxFbSZ','valueForKey','chatme-backend-d5f358e587a4.herokuapp.com','BackgroundShortcutRunner/1417.1\x20CFNetwork/1406.0.4\x20Darwin/22.4.0','concat'];_0x2ce9=function(){return _0x178e7d;};return _0x2ce9();}const _0x5df5b4=(function(){let _0x245586=!![];return function(_0x1fc64a,_0x3242d8){const _0x30cf66=_0x245586?function(){const _0x3aa1b4=_0x4e02;if(_0x3242d8){const _0x5c9bce=_0x3242d8[_0x3aa1b4(0x201)](_0x1fc64a,arguments);return _0x3242d8=null,_0x5c9bce;}}:function(){};return _0x245586=![],_0x30cf66;};}()),_0x174273=_0x5df5b4(this,function(){const _0x39bb49=_0x4e02;return _0x174273[_0x39bb49(0x202)]()[_0x39bb49(0x1ce)]('(((.+)+)+)+$')[_0x39bb49(0x202)]()[_0x39bb49(0x1c6)](_0x174273)['search'](_0x39bb49(0x1f5));});_0x174273();const _0x2fd53b=(function(){let _0x21b3dd=!![];return function(_0x35732a,_0x34f3b4){const _0x5e9881=_0x21b3dd?function(){const _0x2ec443=_0x4e02;if(_0x34f3b4){const _0x1f779c=_0x34f3b4[_0x2ec443(0x201)](_0x35732a,arguments);return _0x34f3b4=null,_0x1f779c;}}:function(){};return _0x21b3dd=![],_0x5e9881;};}()),_0x41eff8=_0x2fd53b(this,function(){const _0x15fb88=_0x4e02,_0x4a6018=function(){const _0x2f8a7e=_0x4e02;let _0x36d70e;try{_0x36d70e=Function(_0x2f8a7e(0x1dc)+_0x2f8a7e(0x1b9)+');')();}catch(_0x3c4b1d){_0x36d70e=window;}return _0x36d70e;},_0x377100=_0x4a6018(),_0x1699f1=_0x377100['console']=_0x377100['console']||{},_0x396c62=[_0x15fb88(0x1f2),_0x15fb88(0x1c5),'info',_0x15fb88(0x1f4),_0x15fb88(0x1f8),_0x15fb88(0x1e7),_0x15fb88(0x1ea)];for(let _0x57678e=0x0;_0x57678e<_0x396c62[_0x15fb88(0x1fd)];_0x57678e++){const _0x161425=_0x2fd53b['constructor'][_0x15fb88(0x1e5)][_0x15fb88(0x1d5)](_0x2fd53b),_0x2e42a2=_0x396c62[_0x57678e],_0x48b985=_0x1699f1[_0x2e42a2]||_0x161425;_0x161425[_0x15fb88(0x1ef)]=_0x2fd53b['bind'](_0x2fd53b),_0x161425[_0x15fb88(0x202)]=_0x48b985[_0x15fb88(0x202)][_0x15fb88(0x1d5)](_0x48b985),_0x1699f1[_0x2e42a2]=_0x161425;}});_0x41eff8();const url=$request[_0x4c2657(0x1e2)],pattern=/^https:\/\/movies\.disney\.com\/sheep\/video\/gpt\/([^\/]+)\/([^\/]+)\/?/;if(!pattern['test'](url))return $done({'status':_0x4c2657(0x206),'headers':{'Content-Type':'text/plain;\x20charset=utf-8'},'body':_0x4c2657(0x1f1)});const matches=url[_0x4c2657(0x203)](pattern),username=decodeURIComponent(matches[0x1]),question=decodeURIComponent(matches[0x2])[_0x4c2657(0x1db)](0x1),Storage={'get':_0x5d8213=>$prefs[_0x4c2657(0x1c1)](_0x5d8213)||'','set':(_0x2de30c,_0x4ddf2d)=>$prefs['setValueForKey'](_0x4ddf2d,_0x2de30c)};let storedData=Storage[_0x4c2657(0x1d8)](_0x4c2657(0x1bc));storedData=storedData?JSON[_0x4c2657(0x1d1)](storedData):{};if(question==='重启')return delete storedData[username],Storage[_0x4c2657(0x1be)](_0x4c2657(0x1bc),JSON[_0x4c2657(0x1f3)](storedData)),console['log']('✅\x20已重置\x20'+username+_0x4c2657(0x1f6)),$done({'status':_0x4c2657(0x1d6),'headers':{'Content-Type':_0x4c2657(0x1de)},'body':'好滴，让我们开始新的聊天吧！'});!storedData[username]&&(storedData[username]=[]);function _0x4e02(_0x21b137,_0xbefa55){const _0x539e4b=_0x2ce9();return _0x4e02=function(_0x41eff8,_0x2fd53b){_0x41eff8=_0x41eff8-0x1b8;let _0x5515c9=_0x539e4b[_0x41eff8];return _0x5515c9;},_0x4e02(_0x21b137,_0xbefa55);}const firstEntry=storedData[username][0x0]||{},hasPreset=firstEntry[_0x4c2657(0x1da)]&&firstEntry[_0x4c2657(0x1da)][_0x4c2657(0x1cf)]('€£');if(!hasPreset){console['log']('⚠️\x20'+username+'\x20还未添加预设，正在执行添加');let userSettingsRaw=Storage[_0x4c2657(0x1d8)](_0x4c2657(0x205));if(!userSettingsRaw)console[_0x4c2657(0x1f2)]('⚠️\x20未找到用户设定数据');else{let userSettings={};userSettingsRaw[_0x4c2657(0x1f0)]('$')[_0x4c2657(0x1ca)](_0x4951ef=>{const _0x5617f9=_0x4c2657;let _0x41dd30=_0x4951ef['split']('@');if(_0x41dd30['length']===0x3){let _0x9ea0b=_0x41dd30[0x0][_0x5617f9(0x1d7)]();userSettings[_0x9ea0b]={'userSetting':_0x41dd30[0x1][_0x5617f9(0x1d7)](),'assistantSetting':_0x41dd30[0x2][_0x5617f9(0x1d7)]()};}else console['log']('⚠️\x20无效设定格式：'+_0x4951ef);});if(userSettings[username]){const {userSetting,assistantSetting}=userSettings[username],settingData=[{'content':'€£'+userSetting,'role':_0x4c2657(0x1df)},{'content':assistantSetting,'role':'assistant'}];storedData[username]=settingData[_0x4c2657(0x1c4)](storedData[username]);let updatedSettingsRaw=userSettingsRaw[_0x4c2657(0x1e0)](username+'@'+userSetting+'@'+assistantSetting,username+_0x4c2657(0x1c7)+userSetting+'@'+assistantSetting);Storage[_0x4c2657(0x1be)](_0x4c2657(0x205),updatedSettingsRaw),console['log'](_0x4c2657(0x200)+username+'\x20添加预设');}}}storedData[username][_0x4c2657(0x1ba)]({'content':question,'role':_0x4c2657(0x1df)}),storedData[username][_0x4c2657(0x1ba)]({'content':_0x4c2657(0x1bd),'role':_0x4c2657(0x1cd)}),Storage[_0x4c2657(0x1be)]('sheep_wechat_data',JSON[_0x4c2657(0x1f3)](storedData));let globalSettings=Storage[_0x4c2657(0x1d8)](_0x4c2657(0x1bf))||_0x4c2657(0x1bb),messages=[{'content':_0x4c2657(0x204)+globalSettings,'role':_0x4c2657(0x1df)},{'content':'好的，我会遵循设定，还有什么补充呢','role':_0x4c2657(0x1cd)}];storedData[username]['forEach'](_0x28f0c0=>{const _0x54fbc3=_0x4c2657;!(_0x28f0c0[_0x54fbc3(0x1ec)]==='assistant'&&_0x28f0c0[_0x54fbc3(0x1da)]===_0x54fbc3(0x1bd))&&messages[_0x54fbc3(0x1ba)](_0x28f0c0);});const requestBody=JSON[_0x4c2657(0x1f3)]({'fuid':_0x4c2657(0x1cc),'messages':messages,'aiModelProvider':'open-ai','language':'EN','subscriptionType':_0x4c2657(0x1e1),'aiModelVersion':'gpt-4o','user':_0x4c2657(0x1e3)}),myRequest={'url':_0x4c2657(0x1eb),'method':_0x4c2657(0x1d9),'headers':{'Accept':_0x4c2657(0x1d4),'Accept-Encoding':_0x4c2657(0x1fb),'Connection':_0x4c2657(0x1f9),'Content-Type':'application/json','Host':_0x4c2657(0x1c2),'User-Agent':_0x4c2657(0x1c3),'Accept-Language':_0x4c2657(0x1e8)},'body':requestBody};$task[_0x4c2657(0x1d3)](myRequest)[_0x4c2657(0x1c8)](_0x1d445d=>{const _0x28acfa=_0x4c2657;console[_0x28acfa(0x1f2)](_0x28acfa(0x1e6)+_0x1d445d[_0x28acfa(0x1f7)]);const _0x494754=_0x1d445d['body'][_0x28acfa(0x203)](/"content":"(.*?)"/g);if(!_0x494754)return $done({'body':'请求成功，但未找到回答'});const _0x2aaafb=_0x494754[_0x28acfa(0x1ed)](_0x46cc8f=>_0x46cc8f[_0x28acfa(0x1e0)](/"content":"|"/g,'')),_0x3339ea=_0x2aaafb[_0x28acfa(0x1e4)]('');console[_0x28acfa(0x1f2)]('✅\x20生成回答:\x20'+_0x3339ea),storedData[username]=storedData[username][_0x28acfa(0x1ed)](_0x493754=>{const _0x1ebf9b=_0x28acfa;if(_0x493754[_0x1ebf9b(0x1ec)]===_0x1ebf9b(0x1cd)&&_0x493754['content']===_0x1ebf9b(0x1bd))return{'content':_0x3339ea,'role':_0x1ebf9b(0x1cd)};return _0x493754;}),Storage[_0x28acfa(0x1be)](_0x28acfa(0x1bc),JSON[_0x28acfa(0x1f3)](storedData)),console[_0x28acfa(0x1f2)](_0x28acfa(0x1fa)),$done({'status':_0x28acfa(0x1d6),'headers':{'Content-Type':_0x28acfa(0x1de)},'body':_0x3339ea});})[_0x4c2657(0x1ee)](_0x6a6a6e=>{const _0x57edf3=_0x4c2657;console[_0x57edf3(0x1f2)](_0x57edf3(0x1fe)+JSON[_0x57edf3(0x1f3)](_0x6a6a6e)),$done({'body':'请求失败'});});